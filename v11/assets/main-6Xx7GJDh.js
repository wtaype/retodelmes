import{$ as a,w as g,g as C,d as f,a as n,b as D,q as L,c as U,e as q,f as T,h as k,u as G,s as S,i as x,j as N,k as V,M as l,l as h,m as $,n as B,o as O,p as W}from"./widev-C43wO8qr.js";a(".toggle-password").click(function(r){r.preventDefault();const u=a(this),b=u.data("target"),p=a("#"+b),w=u.find("i");p.attr("type",(v,d)=>d==="password"?"text":"password").focus(),w.toggleClass("fa-eye fa-eye-slash")});const y=(r,u)=>{a(r).removeClass("active").addClass("hidden"),a(u).removeClass("hidden").addClass("active")};a(".olvidastePass").click(r=>{r.preventDefault(),y(".login-form",".recovery-form")});a(".crearCuenta").click(r=>{r.preventDefault(),y(".login-form",".upd-form")});a(".volverLogin").click(r=>{r.preventDefault(),y(".recovery-form",".login-form")});a(".conCuenta").click(r=>{r.preventDefault(),y(".upd-form",".login-form")});a(function(){let r="smiles",u="configuracion",b=3e3,p="wiAuthIn",w="wiAuthRol",v="smile",d="Cielo";a(".togglePass").click(function(){const e=a(this).siblings("input"),o=e.attr("type")==="password";e.attr("type",o?"text":"password"),a(this).toggleClass("fa-eye fa-eye-slash")}),a('.miauth input:not([type="checkbox"])').on("click",function(){g(this,a(this).attr("placeholder"))}),a("#regUsuario, #regEmail, #email, #recEmail").on("input",function(){a(this).val(a(this).val().toLowerCase().trim())}),[["#password","#Login"],["#regPassword1","#Registrar"],["#recFechaNacimiento","#Recuperar"],["#recEmail","#Recuperar"]].forEach(([e,o])=>{a(e).on("input keyup",s=>{a(o).removeClass("inactivo"),s.key==="Enter"&&(a(o).click(),a(o).addClass("inactivo"))})});const F={regEmail:[e=>e.toLowerCase(),e=>/^[\w-]+(\.[\w-]+)*@([\w-]+\.)+[a-zA-Z]{2,7}$/.test(e)||"Correo inválido"],regUsuario:[e=>e.toLowerCase().replace(/[^a-z0-9_]/g,""),e=>e.length>=3||"Usuario 3-20 caracteres"],regNombre:[e=>e.trim(),e=>e.length>0||"Ingrese nombre"],regApellidos:[e=>e.trim(),e=>e.length>0||"Ingrese apellidos"],regGenero:[e=>e,e=>["femenino","masculino"].includes(e)||"Selecciona género"],regFechaNacimiento:[e=>e,e=>W(e)>=13||"Tienes que ser mayor de 13 años"],regPassword:[e=>e,e=>e.length>=6||"Mínimo 6 caracteres"],regPassword1:[e=>e,e=>e===a("#regPassword").val()||"Contraseñas no coinciden"]};a.each(F,function(e,[o,s]){a(`#${e}`).on("blur change",function(){const i=o(a(this).val());a(this).val(i);const t=s(i);t!==!0&&g(this,t,"error")})});let P=!1;a("#regUsuario").on("blur focus",async function(){const e=a(this).val();if(e.length>=3)try{const s=(await C(f(n,r,e))).exists();P=!s,g(this,`Usuario ${s?"no disponible":'disponible <i class="fa-solid fa-circle-check"></i>'}`,s?"error":"success","top",7e3)}catch(o){console.error(o)}});let R=!1;a("#regEmail").on("blur focus",async function(){const e=a(this).val();if(e.length>=3)try{const s=!(await D(L(U(n,r),q("email","==",e)))).empty;R=!s,g(this,`Email ${s?"no disponible":'disponible <i class="fa-solid fa-circle-check"></i>'}`,s?"error":"success","top",7e3)}catch(o){console.error(o)}}),a("#Registrar").click(async function(){const e=[[P,a("#regUsuario")[0],"Usuario no disponible"],[R,a("#regEmail")[0],"Email no disponible"],...Object.entries(F).map(([o,[s,i]])=>{const t=a(`#${o}`),c=s(t.val()),m=i(c);return[m===!0,t[0],m!==!0?m:""]})];for(const[o,s,i]of e)if(!o&&i&&(g(s,i,"error"),s.focus(),!0))return;try{const o=["regEmail","regUsuario","regNombre","regApellidos","regGenero","regPassword"],[s,i,t,c,m,j]=o.map(z=>a("#"+z).val().trim()),A={masculino:["Cielo|#0EBEFF","Paz|#29C72E"],femenino:["Dulce|#FF5C69","Mora|#7000FF"]}[m]||["Paz|#29C72E","Cielo|#0EBEFF"];d=A[Math.floor(Math.random()*A.length)];const{user:E}=await T(k,s,j);await Promise.all([G(E,{displayName:i}),S(E)]),console.log('Registro completo en Auth <i class="fa-solid fa-circle-check"></i>'+Date());const I=f(n,r,i);await x(I,{usuario:i,email:s,nombre:t,apellidos:c,genero:m,rol:v,fechaNacimiento:V(a("#regFechaNacimiento").val()),creacion:N(),participa:"si",imagen:"",descripcion:"",uid:E.uid});const M=f(n,u,i);await x(M,{usuario:i,email:s,tema:d,actualizacion:N()}),console.log('Registro completo en Firestore <i class="fa-solid fa-circle-check"></i>'+Date()),l('Registro completado! <i class="fa-solid fa-circle-check"></i>')}catch(o){l({"auth/email-already-in-use":"Email ya registrado","auth/weak-password":"Contraseña muy débil"}[o.code]||o.message)||console.error(o)}finally{h(p,"wIn",24),h(w,v,24),h("witema",d,72),setTimeout(()=>$(v),b)}}),a("#Login").click(async function(){try{const[e,o]=["#email","#password"].map(t=>a(t).val());let s=null,i=e;if(!e.includes("@"))try{s=await C(f(n,r,e)),i=s.exists()?s.data().email:null}catch(t){console.error("ebdUsuario",t),i=null}await B(k,i,o),h(p,"wIn",24),h(w,s.data().rol,24),$(s.data().rol)}catch(e){l({"auth/invalid-credential":"Contraseña incorrecta","auth/invalid-email":"Falta registrar Email","auth/missing-email":"Email o usuario no registrado"}[e.code]||e.message,"error"),console.error(e)}}),a("#Recuperar").click(async function(){try{const[e,o]=["#recEmail","#recFechaNacimiento"].map(c=>a(c).val()),s=e.includes("@")?e:await(async()=>{const c=await C(f(n,r,e));return c.exists()?c.data().email:null})();if(!s)return l("Usuario no registrado","error");const i=await D(L(U(n,r),q("email","==",s)));if(i.empty)return l("Email incorrecto o no existe","error");if(i.docs[0].data().fechaNacimiento.toDate().toISOString().split("T")[0]!==o)return l("Fecha de nacimiento incorrecta","error");await O(k,s),l('Se envió correo para restablecer su contraseña, revisa en principal o spam <i class="fa-solid fa-circle-check"></i>',"success")}catch(e){console.error(e)}})});
