import{$ as a,w as g,g as f,d as m,a as n,b as F,q as P,c as R,e as A,f as M,h as y,u as z,s as G,i as E,j as C,k as S,M as l,l as u,m as D,n as k,o as V,p as B,r as O}from"./widev-Bw9TxyzX.js";a(".toggle-password").click(function(e){e.preventDefault();const s=a(this),o=s.data("target"),i=a("#"+o),r=s.find("i");i.attr("type",(t,c)=>c==="password"?"text":"password").focus(),r.toggleClass("fa-eye fa-eye-slash")});const h=(e,s)=>{a(e).removeClass("active").addClass("hidden"),a(s).removeClass("hidden").addClass("active")};a(".olvidastePass").click(e=>{e.preventDefault(),h(".login-form",".recovery-form")});a(".crearCuenta").click(e=>{e.preventDefault(),h(".login-form",".upd-form")});a(".volverLogin").click(e=>{e.preventDefault(),h(".recovery-form",".login-form")});a(".conCuenta").click(e=>{e.preventDefault(),h(".upd-form",".login-form")});let d="smiles",W="configuracion",Z=3e3,L="wiAuthIn",U="wiAuthRol",w="smile",v="Cielo";a(".togglePass").click(function(){const e=a(this).siblings("input"),s=e.attr("type")==="password";e.attr("type",s?"text":"password"),a(this).toggleClass("fa-eye fa-eye-slash")});a('.miauth input:not([type="checkbox"])').on("click",function(){g(this,a(this).attr("placeholder"))});a("#regUsuario, #regEmail, #email, #recEmail").on("input",function(){a(this).val(a(this).val().toLowerCase().trim())});[["#password","#Login"],["#regPassword1","#Registrar"],["#recFechaNacimiento","#Recuperar"],["#recEmail","#Recuperar"]].forEach(([e,s])=>{a(e).on("input keyup",o=>{a(s).removeClass("inactivo"),o.key==="Enter"&&(a(s).click(),a(s).addClass("inactivo"))})});const q={regEmail:[e=>e.toLowerCase(),e=>/^[\w-]+(\.[\w-]+)*@([\w-]+\.)+[a-zA-Z]{2,7}$/.test(e)||"Correo inválido"],regUsuario:[e=>e.toLowerCase().replace(/[^a-z0-9_]/g,""),e=>e.length>=3||"Usuario 3-20 caracteres"],regNombre:[e=>e.trim(),e=>e.length>0||"Ingrese nombre"],regApellidos:[e=>e.trim(),e=>e.length>0||"Ingrese apellidos"],regGenero:[e=>e,e=>["femenino","masculino"].includes(e)||"Selecciona género"],regFechaNacimiento:[e=>e,e=>O(e)>=13||"Tienes que ser mayor de 13 años"],regPassword:[e=>e,e=>e.length>=6||"Mínimo 6 caracteres"],regPassword1:[e=>e,e=>e===a("#regPassword").val()||"Contraseñas no coinciden"]};a.each(q,function(e,[s,o]){a(`#${e}`).on("blur change",function(){const i=s(a(this).val());a(this).val(i);const r=o(i);r!==!0&&g(this,r,"error")})});let x=!1;a("#regUsuario").on("blur focus",async function(){const e=a(this).val();if(e.length>=3)try{const o=(await f(m(n,d,e))).exists();x=!o,g(this,`Usuario ${o?"no disponible":'disponible <i class="fa-solid fa-circle-check"></i>'}`,o?"error":"success","top",7e3)}catch(s){console.error(s)}});let N=!1;a("#regEmail").on("blur focus",async function(){const e=a(this).val();if(e.length>=3)try{const o=!(await F(P(R(n,d),A("email","==",e)))).empty;N=!o,g(this,`Email ${o?"no disponible":'disponible <i class="fa-solid fa-circle-check"></i>'}`,o?"error":"success","top",7e3)}catch(s){console.error(s)}});a("#Registrar").click(async function(){const e=[[x,a("#regUsuario")[0],"Usuario no disponible"],[N,a("#regEmail")[0],"Email no disponible"],...Object.entries(q).map(([s,[o,i]])=>{const r=a(`#${s}`),t=o(r.val()),c=i(t);return[c===!0,r[0],c!==!0?c:""]})];for(const[s,o,i]of e)if(!s&&i&&(g(o,i,"error"),o.focus(),!0))return;try{const s=["regEmail","regUsuario","regNombre","regApellidos","regGenero","regPassword"],[o,i,r,t,c,$]=s.map(T=>a("#"+T).val().trim()),b={masculino:["Cielo|#0EBEFF","Paz|#29C72E"],femenino:["Dulce|#FF5C69","Mora|#7000FF"]}[c]||["Paz|#29C72E","Cielo|#0EBEFF"];v=b[Math.floor(Math.random()*b.length)];const{user:p}=await M(y,o,$);await Promise.all([z(p,{displayName:i}),G(p)]),console.log('Registro completo en Auth <i class="fa-solid fa-circle-check"></i>'+Date());const j=m(n,d,i);await E(j,{usuario:i,email:o,nombre:r,apellidos:t,genero:c,rol:w,fechaNacimiento:S(a("#regFechaNacimiento").val()),creacion:C(),participa:"si",imagen:"",descripcion:"",uid:p.uid});const I=m(n,W,i);await E(I,{usuario:i,email:o,tema:v,actualizacion:C()}),console.log('Registro completo en Firestore <i class="fa-solid fa-circle-check"></i>'+Date()),l('Registro completado! <i class="fa-solid fa-circle-check"></i>')}catch(s){l({"auth/email-already-in-use":"Email ya registrado","auth/weak-password":"Contraseña muy débil"}[s.code]||s.message)||console.error(s)}finally{u(L,"wIn",24),u(U,w,24),u("wiTema",v,72),setTimeout(()=>D(w),Z)}});a("#Login").click(async function(){k(!0);try{const[e,s]=["#email","#password"].map(c=>a(c).val());let o=e,i=null,r=null;if(!e.includes("@")){if(i=await f(m(n,d,e)),!i.exists())throw new Error("Usuario no encontrado");o=i.data().email;try{r=(await f(m(n,"configuracion",e))).data()?.tema}catch{}}await V(y,o,s);const t=i?.data()?.rol||"smile";u(L,"wIn",24),u(U,t,24),r&&u("wiTema",r,72),D(t)}catch(e){l({"auth/invalid-credential":"Contraseña incorrecta","auth/invalid-email":"Falta registrar Email","auth/missing-email":"Email o usuario no registrado"}[e.code]||e.message,"error"),console.error(e)}finally{k(!1)}});a("#Recuperar").click(async function(){try{const[e,s]=["#recEmail","#recFechaNacimiento"].map(t=>a(t).val()),o=e.includes("@")?e:await(async()=>{const t=await f(m(n,d,e));return t.exists()?t.data().email:null})();if(!o)return l("Usuario no registrado","error");const i=await F(P(R(n,d),A("email","==",o)));if(i.empty)return l("Email incorrecto o no existe","error");if(i.docs[0].data().fechaNacimiento.toDate().toISOString().split("T")[0]!==s)return l("Fecha de nacimiento incorrecta","error");await B(y,o),l('Se envió correo para restablecer su contraseña, revisa en principal o spam <i class="fa-solid fa-circle-check"></i>',"success")}catch(e){console.error(e)}});
