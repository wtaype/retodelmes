import{$ as a,w as g,g as f,d as m,a as n,b as P,q as A,c as R,e as D,f as I,h as E,u as M,s as z,i as C,j as k,k as G,M as l,l as u,m as L,n as F,o as S,p as V,r as B}from"./widev-9nBR2YtD.js";a(".toggle-password").click(function(e){e.preventDefault();const s=a(this),i=s.data("target"),o=a("#"+i),r=s.find("i");o.attr("type",(t,c)=>c==="password"?"text":"password").focus(),r.toggleClass("fa-eye fa-eye-slash")});const h=(e,s)=>{a(e).removeClass("active").addClass("hidden"),a(s).removeClass("hidden").addClass("active")};a(".olvidastePass").click(e=>{e.preventDefault(),h(".login-form",".recovery-form")});a(".crearCuenta").click(e=>{e.preventDefault(),h(".login-form",".upd-form")});a(".volverLogin").click(e=>{e.preventDefault(),h(".recovery-form",".login-form")});a(".conCuenta").click(e=>{e.preventDefault(),h(".upd-form",".login-form")});let d="smiles",O=3e3,U="wiAuthIn",q="wiAuthRol",v="smile",y="Cielo";a(".togglePass").click(function(){const e=a(this).siblings("input"),s=e.attr("type")==="password";e.attr("type",s?"text":"password"),a(this).toggleClass("fa-eye fa-eye-slash")});a('.miauth input:not([type="checkbox"])').on("click",function(){g(this,a(this).attr("placeholder"))});a("#regUsuario, #regEmail, #email, #recEmail").on("input",function(){a(this).val(a(this).val().toLowerCase().trim())});[["#password","#Login"],["#regPassword1","#Registrar"],["#recFechaNacimiento","#Recuperar"],["#recEmail","#Recuperar"]].forEach(([e,s])=>{a(e).on("input keyup",i=>{a(s).removeClass("inactivo"),i.key==="Enter"&&(a(s).click(),a(s).addClass("inactivo"))})});const x={regEmail:[e=>e.toLowerCase(),e=>/^[\w-]+(\.[\w-]+)*@([\w-]+\.)+[a-zA-Z]{2,7}$/.test(e)||"Correo inválido"],regUsuario:[e=>e.toLowerCase().replace(/[^a-z0-9_]/g,""),e=>e.length>=3||"Usuario 3-20 caracteres"],regNombre:[e=>e.trim(),e=>e.length>0||"Ingrese nombre"],regApellidos:[e=>e.trim(),e=>e.length>0||"Ingrese apellidos"],regGenero:[e=>e,e=>["femenino","masculino"].includes(e)||"Selecciona género"],regFechaNacimiento:[e=>e,e=>B(e)>=13||"Tienes que ser mayor de 13 años"],regPassword:[e=>e,e=>e.length>=6||"Mínimo 6 caracteres"],regPassword1:[e=>e,e=>e===a("#regPassword").val()||"Contraseñas no coinciden"]};a.each(x,function(e,[s,i]){a(`#${e}`).on("blur change",function(){const o=s(a(this).val());a(this).val(o);const r=i(o);r!==!0&&g(this,r,"error")})});let N=!1;a("#regUsuario").on("blur focus",async function(){const e=a(this).val();if(e.length>=3)try{const i=(await f(m(n,d,e))).exists();N=!i,g(this,`Usuario ${i?"no disponible":'disponible <i class="fa-solid fa-circle-check"></i>'}`,i?"error":"success","top",7e3)}catch(s){console.error(s)}});let T=!1;a("#regEmail").on("blur focus",async function(){const e=a(this).val();if(e.length>=3)try{const i=!(await P(A(R(n,d),D("email","==",e)))).empty;T=!i,g(this,`Email ${i?"no disponible":'disponible <i class="fa-solid fa-circle-check"></i>'}`,i?"error":"success","top",7e3)}catch(s){console.error(s)}});a("#Registrar").click(async function(){const e=[[N,a("#regUsuario")[0],"Usuario no disponible"],[T,a("#regEmail")[0],"Email no disponible"],...Object.entries(x).map(([s,[i,o]])=>{const r=a(`#${s}`),t=i(r.val()),c=o(t);return[c===!0,r[0],c!==!0?c:""]})];for(const[s,i,o]of e)if(!s&&o&&(g(i,o,"error"),i.focus(),!0))return;try{const s=["regEmail","regUsuario","regNombre","regApellidos","regGenero","regPassword"],[i,o,r,t,c,p]=s.map(j=>a("#"+j).val().trim()),b={masculino:["Cielo|#0EBEFF","Paz|#29C72E"],femenino:["Dulce|#FF5C69","Mora|#7000FF"]}[c]||["Paz|#29C72E","Cielo|#0EBEFF"];y=b[Math.floor(Math.random()*b.length)];const{user:w}=await I(E,i,p);await Promise.all([M(w,{displayName:o}),z(w)]),console.log('Registro completo en Auth <i class="fa-solid fa-circle-check"></i>'+Date());const $=m(n,d,o);await C($,{usuario:o,email:i,nombre:r,apellidos:t,genero:c,rol:v,fechaNacimiento:G(a("#regFechaNacimiento").val()),creacion:k(),participa:"si",imagen:"",descripcion:"",uid:w.uid}),await C(m(n,"preferencias",o),{usuario:o,email:i,wiTema:y,fechaActualizacion:k()}),console.log('Registro completo en Firestore <i class="fa-solid fa-circle-check"></i>'+Date()),l('Registro completado! <i class="fa-solid fa-circle-check"></i>')}catch(s){l({"auth/email-already-in-use":"Email ya registrado","auth/weak-password":"Contraseña muy débil"}[s.code]||s.message)||console.error(s)}finally{u(U,"wIn",24),u(q,v,24),u("wiTema",y,72),setTimeout(()=>L(v),O)}});a("#Login").click(async function(){F(!0);try{const[e,s]=["#email","#password"].map(p=>a(p).val()),i=e.includes("@"),o=i?null:await f(m(n,d,e));if(!i&&!o.exists())throw new Error("Usuario no encontrado");const r=i?e:o.data().email;await S(E,r,s);const t=o?.data()?.rol||"smile";L(t);const c=i?null:(await f(m(n,"preferencias",e)).catch(()=>({data:()=>({})}))).data()?.wiTema;u(U,"wIn",24),u(q,t,24),c&&u("wiTema",c,72)}catch(e){l({"auth/invalid-credential":"Contraseña incorrecta","auth/invalid-email":"Falta registrar Email","auth/missing-email":"Email o usuario no registrado"}[e.code]||e.message,"error"),console.error(e)}finally{F(!1)}});a("#Recuperar").click(async function(){try{const[e,s]=["#recEmail","#recFechaNacimiento"].map(t=>a(t).val()),i=e.includes("@")?e:await(async()=>{const t=await f(m(n,d,e));return t.exists()?t.data().email:null})();if(!i)return l("Usuario no registrado","error");const o=await P(A(R(n,d),D("email","==",i)));if(o.empty)return l("Email incorrecto o no existe","error");if(o.docs[0].data().fechaNacimiento.toDate().toISOString().split("T")[0]!==s)return l("Fecha de nacimiento incorrecta","error");await V(E,i),l('Se envió correo para restablecer su contraseña, revisa en principal o spam <i class="fa-solid fa-circle-check"></i>',"success")}catch(e){console.error(e)}});
